pool:
  vmImage: 'ubuntu-latest'

variables:
  - group: npm publish token

steps:
- task: NodeTool@0
  displayName: 'Use Node 16.x'
  inputs:
    versionSpec: 16.x


- task: Bash@3
  displayName: 'Configure .npmrc with NPM_TOKEN config'
  inputs:
    targetType: 'inline'
    script: |
      echo -e "\r\n//registry.npmjs.org/:_authToken=\${NPM_TOKEN}" >> .npmrc
  env:
    NPM_TOKEN: $(NpmPublishToken)

- task: Bash@3
  displayName: 'yarn install'
  inputs:
    targetType: inline
    script: |
      yarn

- task: Bash@3
  displayName: 'yarn build & publish api-client'
  inputs:
    targetType: inline
    script: |
        yarn build:api-client && yarn publish:api-client "${NPM_TOKEN}"
  env:
      NPM_TOKEN: $(NpmPublishToken)

- task: Bash@3
  displayName: 'yarn build & publish composables'
  inputs:
    targetType: inline
    script: |
        yarn build:composables && yarn publish:composables "${NPM_TOKEN}"
  env:
      NPM_TOKEN: $(NpmPublishToken)